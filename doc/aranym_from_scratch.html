<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>ARAnyM from scratch</title>
</head><body>

<h1>Howto create your own ARAnyM setup from scratch</h1>

<p>We, ARAnyM developpers hear many horror tales about ARAnyM installation, configuration
and setup by beginners, or even people which know a lot about Atari computers.<br>
<br>
Maybe we should share knowledge about how we got a working configuration using
ARAnyM and pure Atari software? So let's start.
</p>

<h2>0 - Table of contents</h2>

<h3><a href="#compilation">1</a> - Compilation, getting an ARAnyM binary</h3>
<h3><a href="#firsttry">2</a> - First try</h3>
<h3><a href="#os">3</a> - Setup the operating system</h3>
<h4><a href="#os_tos">3.1</a> - TOS</h4>
<h4><a href="#os_emutos">3.2</a> - EmuTOS</h4>
<h4><a href="#os_linux">3.3</a> - Linux/m68k</h4>
<h5><a href="#os_linux_rd">3.3.1</a> - Ramdisk image file</h5>
<h5><a href="#os_linux_fd">3.3.2</a> - Floppy disk or image file</h5>
<h5><a href="#os_linux_log">3.3.3</a> - Linux/m68k example boot log, using ramdisk image file</h5>
<h3><a href="#floppy">4</a> - Create and setup a floppy disk image</h3>
<h4><a href="#floppy_linux">4.1</a> - Under Linux (and maybe other Unices)</h4>
<h5><a href="#floppy_linux_real">4.1.1</a> - From a real floppy disk</h5>
<h5><a href="#floppy_linux_scratch">4.1.2</a> - From scratch (top l33t!)</h5>
<h4><a href="#floppy_otheros">4.2</a> - Some other OS</h4>
<h3><a href="#harddisk">5</a> - Create and setup a hard disk image (IDE emulation)</h3>
<h4><a href="#harddisk_image">5.1</a> - Create the hard disk image</h4>
<h4><a href="#harddisk_atari">5.2</a> - Partition the hard disk image (Atari side)</h4>
<h5><a href="#harddisk_atari_hdx">5.2.1</a> - Atari HDX 5.04</h5>
<h5><a href="#harddisk_atari_cecile">5.2.2</a> - Cecile 2.22</h5>
<h5><a href="#harddisk_atari_hddriver">5.2.3</a> - HD Driver 8.13</h5>
<h5><a href="#harddisk_atari_cbhd">5.2.4</a> - CBHD 5.02</h5>
<h5><a href="#harddisk_atari_scsitools">5.2.5</a> - SCSI Tools 6.52</h5>
<h5><a href="#harddisk_atari_icd">5.2.6</a> - ADSCSI</h5>
<h4><a href="#harddisk_linux">5.3</a> - Partition the hard disk image under Linux</h4>
<h5><a href="#harddisk_linux_fdisk">5.3.1</a> - Using fdisk</h5>
<h5><a href="#harddisk_linux_sfdisk">5.3.2</a> - Using sfdisk</h5>
<h3><a href="#drivers">6</a> - ARAnyM specific drivers</h3>
<h4><a href="#drivers_fvdi">6.1</a> - FVDI</h4>
<h5><a href="#drivers_fvdi_resolution">6.1.1</a> - Setting FVDI's video resolution</h5>
<h5><a href="#drivers_fvdi_hostmouse">6.1.2</a> - Using host mouse cursor</h5>
<h5><a href="#drivers_fvdi_renderer">6.1.3</a> - Selecting VDI renderer</h5>
<h4><a href="#drivers_hostfs">6.2</a> - Filesystem driver</h4>
<h5><a href="#drivers_hostfs_dos">6.2.1</a> - MetaDOS driver</h5>
<h5><a href="#drivers_hostfs_xfs">6.2.2</a> - MiNT driver</h5>
<h4><a href="#drivers_network">6.3</a> - Network driver</h4>
<h4><a href="#drivers_nfcdrom">6.4</a> - CD-ROM driver</h4>
<h4><a href="#drivers_nfjpeg">6.5</a> - JPEG image decoder</h4>
<h4><a href="#drivers_nfosmesa">6.6</a> - OSMesa software OpenGL driver</h4>
<h4><a href="#drivers_nfpci">6.7</a> - PCI driver</h4>
<h4><a href="#drivers_audio">6.8</a> - Audio driver</h4>
<h3><a href="#links">7</a> - Links</h3>

<hr>

<a name="compilation"><h2>1 - Compilation, getting an ARAnyM binary</h2></a>

<p>If you are skilled enough to compile sources, you don't need any help, except
for knowing which elements you need to enable at configure time. [TODO].<br>
<br>
For now, I consider you got a binary for ARAnyM (either .exe or anything else that
can be launched).
</p>

<a name="firsttry"><h2>2 - First try</h2></a>

<p>If you do a fresh start (no existing configuration file), you'd better launch
ARAnyM from a console window (the black/white thing where you type mystical commands),
whatever your OS (Linux, win32, or MacOSX). It will be easier for you to know what
prevents ARAnyM from working.</p>

<pre>
$ aranym
ARAnyM 0.9.2pre1
Config file '/home/patrice/.aranym/config' not found.
The config file is created with default values. Edit it to suit your needs.
TOS image '/usr/local/share/aranym/ROM' not found.
EmuTOS image '/usr/local/share/aranym/etos512k.img' not found.
No operating system found. ARAnyM can not boot!
Visit http://emutos.sourceforge.net/ and get your copy of EmuTOS now.
Couldn't protect ROM
</pre>

<p>So what do have? First, it does not find its configuration file (the path to
this file is OS-dependent, it should written somewhere in the doc). On any Unix
system, it is '${HOME}/.aranym/config'. As the program says, it creates a default
one, so you only need to read where it is created, and then you'll have to edit it
to suit your needs.<br>
<br>
You'll also get a default nvram setting, which is VGA monitor, 320x200x16 colors
boot screen and some other default setting for date format, keyboard and country.
You can change it by using a nvram utility like 'bootconf.prg' <a href="#link1">[1]</a>.
</p>

<a name="os"><h2>3 - Setup the operating system</h2></a>

<p>ARAnyM is only the hardware platform on which the Atari software will run. And
the first software to run before you can run an application is an Atari Operating
System:<br>
<br>
Original Atari machines and clones have an operating system residing in a ROM
chip on the motherboard: the TOS. ARAnyM supports only the 4.04 version of the TOS,
which is the latest produced by Atari for the Falcon 030. There are some dumping
software that can read it from your Falcon for use with ARAnyM.<br>
<br>
You can also use a more recent license-free operating system ROM image, that is
EmuTOS <a href="#link2">[2]</a>.<br>
<br>
The latest possibility is to use Linux/m68k kernel as an alternative OS. Running
it requires ARAnyM to be compiled with MMU (so you'll get no JIT, and using
MMU slows down the m68k emulation a lot) and Lilo (Linux loader) support.

<a name="os_tos"><h3>3.1 - TOS</h3></a>

<p>Just edit the config file, in the [GLOBAL] section, you'll find the 'TOS=' line
to fill with the complete path to a TOS 4.04 ROM image file. If you run ARAnyM with
it, after the Atari logo, you should reach the well-known GEM desktop.</p>

<pre>
$ aranym
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
TOS 4.04 loading... [OK]
NVRAM loaded from '/home/patrice/.aranym/nvram'
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
Floppy read(-1, 001cc6, 1) failed.
</pre>

<a name="os_emutos"><h3>3.2 - EmuTOS</h3></a>

<p>Just like TOS, edit the config file, in the [GLOBAL] section, you'll get the
'EmuTOS=' line to fill with the complete path to a EmuTOS ROM image file. If you
have both TOS and EmuTOS available, ARAnyM defaults to TOS. You can force EmuTOS
usage using '-e' command-line parameter:</p>

<pre>
$ aranym -e
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
EmuTOS 2005/09/18 loading from '/usr/local/share/atari-emu/emutos-0.8.1-512k.img'... [OK]
NVRAM loaded from '/home/patrice/.aranym/nvram'
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
TunTap(0): ERROR: aratapif not found. Ethernet disabled!
BIOS: Detected memory: ST-RAM = 14 MB, FastRAM = 0 MB
BDOS: Address of basepage = 00013000
BDOS: cinit - osinit successful ...
Floppy read(-1, 009fcc, 1) failed.
hdv_boot returns 3
</pre>

<p>There you get the EmuTOS boot screen, pressing any key provides this crash.</p>

<pre>
Panic: bus error. misc = 0x2000, address = 0x00e01254
opcode = 0x7008, sr = 0x602e, pc = 0x02060000
Aregs: 602e0206 00e2bdac 00018a40 00018c74  00000000 00014a90 000151da 00015144
Dregs: 0000046c 00000004 0000001c 00000000  00000000 00000000 00000000 00000000
Processor halted.
</pre>

<a name="os_linux"><h3>3.3 - Linux/m68k</h3></a>

<p>Linux/m68k settings have a special section [LILO] (for Linux loader), where
you have some work to do. You must provide the kernel image <a href="#link3">[3]</a> file to use (of
course) in the line 'Kernel='. A list of arguments to pass to the kernel to tell
it some infos about the system, in the line 'Args=', and a root filesystem.<br>
<br>
The 'Args=' line must be filled with some infos, like the Atari frame buffer format,
or more precisely, the video mode to use. Interleaved bitplanes formats are not
supported, so it must be either monochrome (use 'video=atafb:sthigh') or 16 bits
true colour mode.<br>
<br>
You also need to add 'console=tty0' if you enable debugging by adding 'debug
debug=&lt;debug device&gt;' for the Linux kernel to open the root console, or it
will fail to go further in the boot process once it has mounted its root
filesystem.
<br>
The root filesystem is the filesystem the Linux kernel will boot from, and is
required. It can be a ramdisk image file, a floppy disk, or a partition from a
hard disk. For ARAnyM, the floppy disk and the partition can be image files.<br>
<br>
Once these lines (Kernel, Args, maybe Ramdisk) are filled, you can start ARAnyM
with '-l' command-line parameter (wait a bit before Linux kernel starts)</p>
</p>

<a name="os_linux_rd"><h4>3.3.1 - Ramdisk image file</h4></a>

<p>Give to ARAnyM's linux loader the full path to a ramdisk image file <a href="#link3">[3]</a>
in the line 'Ramdisk='. It can be gzipped, no need to uncompress it yourself.<br>
<br>
You'll need to have 'root=/dev/ram load_ramdisk=1 ramdisk_size=&lt;n&gt;' in the
'Args=' line. Replace &lt;n&gt; with a size in KB to allocate for the uncompressed
ramdisk in RAM, 8000 seems to be a good default value. In fact this value is the
size of the uncompressed ramdisk image. Remember you only have 14MB of STRAM, so
add at least 16MB of FastRam to ARAnyM if you want to try Linux/m68k. This is the
'FastRAM=' value in the [GLOBAL] section.<br>
</p>

<pre>
[LILO]
Kernel = /path/to/vmlinuz-2.2.25-atari
Args = root=/dev/ram load_ramdisk=1 ramdisk_size=8000 [add some other arguments if needed]
Ramdisk = /path/to/initrd22.gz
</pre>

<a name="os_linux_fd"><h4>3.3.2 - Floppy disk or image file</h4></a>

<p>If you use the floppy disk image atari-root.img.gz from <a href="#link3">[3]</a>,
uncompress it using gunzip, then edit the configuration file this way, to boot from
the floppy disk image. You could also dd/rawcopy the image file to a real floppy
disk, and use 'Floppy =' to point to your real floppy drive.
</p>

<pre>
[GLOBAL]
Floppy = /path/to/atari-root.img

[LILO]
Kernel = /path/to/vmlinuz-2.2.25-atari
Args = root=/dev/fd0 [add some other arguments if needed]
</pre>

<a name="os_linux_log"><h4>3.3.3 - Linux/m68k example boot log, using ramdisk image file</h4></a>

<p>Note: I already had a 4MB disk image as IDE0 disk (hda in the log).</p>

<pre>
$ aranym -l
Linux version 2.2.25-atari (root@aahz) (gcc version 2.7.2.3) #1 Wed Mar 17 18:40:05 CET 2004
Atari hardware found: VIDEL STDMA-SCSI ST_MFP STND_DMA YM2149 PCM CODEC DSP56K ANALOG_JOY BLITTER IDE TT_CLK FDC_SPEED
Console: colour dummy device 80x25
Calibrating delay loop... 1.02 BogoMIPS
Memory: 15872k/30720k available (1152k kernel code, 624k data, 72k init)
Dentry hash table entries: 4096 (order 3, 32k)
Buffer cache hash table entries: 32768 (order 5, 128k)
kmem_create: Forcing size word alignment - buffer_head
Page cache hash table entries: 8192 (order 3, 32k)
kmem_create: Forcing size word alignment - filp
VFS: Diskquotas version dquot_6.4.0 initialized
kmem_create: Forcing size word alignment - dquot
POSIX conformance testing by UNIFIX
Linux/m68k PCI BIOS32 revision 0.01
PCI: No PCI bus detected
Linux NET4.0 for Linux 2.2
Based upon Swansea University Computer Society NET3.039
kmem_create: Forcing size word alignment - sock
kmem_create: Forcing size word alignment - skbuff_head_cache
NET4: Unix domain sockets 1.0 for Linux NET4.0.
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP
kmem_create: Forcing size word alignment - tcp_open_request
kmem_create: Forcing size word alignment - tcp_tw_bucket
TCP: Hash tables configured (ehash 32768 bhash 32768)
Initializing RT netlink socket
Starting kswapd v 1.5
Console: switching to mono frame buffer device 80x25
Determined 640x400, depth 1
   virtual 640x870
fb0: Atari Builtin sthigh frame buffer device, using 68K of video memory
M68K Serial driver version 1.01
pty: 256 Unix98 ptys configured
Atari mouse installed.
Real Time Clock Driver v1.10
Non-volatile memory driver v1.2
Probing nvram size...  found 64 bytes
RAM disk driver initialized:  16 RAM disks of 8000K size
loop: registered device at major 7
ide0: Falcon IDE interface
hda: Master, ATA DISK drive
ide0 at fff00000 on irq 0x0000000f
hda: Master, 3MB w/256kB Cache, CHS=8/16/63
Atari floppy driver: max. HD, track buffering
Probing floppy drive(s):
fd0
md driver 0.36.6 MAX_MD_DEV=4, MAX_REAL=8
Atari SCSI: resetting the SCSI bus... done
scsi0: options CAN_QUEUE=8 CMD_PER_LUN=1 SCAT-GAT=0 TAGGED-QUEUING=no HOSTID=7 generic options AUTOSENSE REAL DMA SCSI-2 TAGGED QUEUING generic release=7
scsi0 : Atari native SCSI
scsi : 1 host.
scsi : detected total.
Partition check:
 hda: AHDI GEM(3) hda1
VFS: Mounted root (ext2 filesystem) readonly.
Setting up filesystem, please wait ...
umount: /initrd: Invalid argument
mount: Mounting devfs on /dev failed: No such device
Starting system log daemon: syslogd, klogd.
Setting up Userspace DevFS:
  Detecting cdrom devices ...
Creating cdrom devices ...
  Hard disk and partitions ...
  Userdevfs sub-arch specific handling ...
Userdevfs done.
[not patient enough to wait more :-)]
</pre>

<a name="floppy"><h2>4 - Create and setup a floppy disk image</h2></a>

<p>If your system does not have a floppy drive, or the direct floppy usage is not
supported on your system - i.e. not win32 and Linux/Unix (correct me if it's wrong -,
then your only option to start some Atari software is by using floppy disk images.<br>
<br>
The floppy image can be selected in Aranym GUI, press 'Pause' (or the OS-dependent key
which has this feature, read the doc), and go to disk submenu. This is the topmost
feature on this screen. Or you can edit the configuration file, line 'Floppy=' in
[GLOBAL] section.<br>
<br>
But we must create one first, before ARAnyM can use it.
</p>

<a name="floppy_linux"><h3>4.1 - Under Linux (and maybe other Unices)</h3></a>

<a name="floppy_linux_real"><h4>4.1.1 - From a real floppy disk</h4></a>

<p>Creating a floppy image from a real floppy disk is dead simple:</p>

<pre>
$ dd if=/dev/fd0 of=/path/to/floppy.img
</pre>

<a name="floppy_linux_scratch"><h4>4.1.2 - From scratch (top l33t!)</h4></a>

<p>First, we create an empty file, which has the same size as a 1.44 MB floppy.</p>

<pre>
$ dd if=/dev/zero of=/path/to/floppy.img bs=1024 count=1440
</pre>

<p>Then, we format it (using either vfat or msdos file system):</p>

<pre>
$ /sbin/mkfs.msdos /path/to/floppy.img
</pre>

<p>It was easy to put files from an Atari system from a floppy disk to a floppy image.
But if we already have the Atari files on the host system, how can we put them on
the floppy image? Well, we mount it using the special loopback device:
</p>

<pre>
# losetup /dev/loop0 /path/to/floppy.img
# mount -t msdos /dev/loop0 /mnt
</pre>

<p>Note: only root user can create this special mapping, and now, your floppy image
is mounted in /mnt on your host system. You can copy your Atari files to it. When
you are finished with this transfer task, unmount the floppy image, and unset
the loop device:</p>

<pre>
# unmount /mnt
# losetup -d /dev/loop0
</pre>

<a name="floppy_otheros"><h3>4.2 - Some other OS</h3></a>

<p>[TODO]</p>

<a name="harddisk"><h2>5 - Create and setup a hard disk image (IDE emulation)</h2></a>

<p>I won't explain how to use a real hard disk from your old Atari computer, it is
safer to use a blank disk image to test. So, I will make it using TOS.</p>

<a name="harddisk_image"><h3>5.1 - Create the hard disk image</h3></a>

<p>Run ARAnyM, once you reach the GEM desktop, press 'Pause' (or the OS-dependent key
which has this feature, read the doc), and go to disk submenu. There you can choose
the floppy disk image, and one hard disk image for each IDE device (master and
slave).<br>
<br>
Select 'Path' and choose the location (and name) of the hd image. Then select the
size (in MB), and click 'Generate'. ARAnyM asks for confirmation, then does its job.
A geometry has been chosen for this hd image (C/H/S = 8/16/63). Enable it by selecting
the 'Present' checkbox. Select 'Apply' to go back to menu, then save the config
file. If you shutdown ARAnyM, and edit the config file, you'll find what has
been done in section [IDE0] of the config file.<br><br>
On a real machine, it means we have plugged an hard disk in our machine, it does
not mean there is software to drive it, which is the task of a hard disk driver.
EmuTOS has one embedded, whereas TOS has not. However, the hard disk image must be
partitionned to be used directly by EmuTOS:</p>

<pre>
$ aranym -e
ARAnyM 0.9.2pre1
Using config file: '/home/patrice/.aranym/config'
[snip]
hda: Non-ATARI root sector
[snip]
</pre>

<p>We need software to partition our hard disk image. Either from host side (with
host specific tools that must create an Atari root sector), or from Atari side
(using floppy disks or images to run software).</p>

<a name="harddisk_atari"><h3>5.2 - Partition the hard disk image (Atari side)</h3></a>

<p>We can use several Atari Hard Disk drivers:</p>

<ul>
<li>AHDI, from Atari (partition utility is named hdx) <a href="#link4">[4]</a> <a href="#link7">[7]</a>
<li>CBHD, from Steffen Engel <a href="#link4">[4]</a> <a href="#link5">[5]</a> <a href="#link7">[7]</a>
<li>Cecile, from Centek <a href="#link6">[6]</a>
<li>HD Driver, from Uwe Seimet <a href="#link1">[1]</a>, demo at <a href="#link4">[4]</a> <a href="#link5">[5]</a> <a href="#link7">[7]</a>
<li>SCSI tools, from Julian Reschke
<li>ADSCSI, from ICD <a href="#link7">[7]</a>
</ul>

<p>The question is, which ones work with ARAnyM?</p>

<a name="harddisk_atari_hdx"><h4>5.2.1 - Atari HDX 5.04</h4></a>

<p>I got one error message when going to menu Disk->Partition, and ARAnyM crashes:</p>

<pre>
hard drive: io read to address f00001 unsupported
hard drive: shouldnt get here!
Segmentation fault
</pre>

<a name="harddisk_atari_cecile"><h4>5.2.2 - Cecile 2.22</h4></a>

<p>First run cecile.prg, so the partition utility (cc_tools.prg) can access the
IDE hard disk. Run cc_tools.prg, select 'partition', then the first IDE hard disk.
Create one partition on this hard disk. Then select 'install' to install the cecile.sys
hard disk driver on it, selecting the first partition to boot from. Bingo, you
can reboot ARAnyM, and it is now booting from the IDE disk image.<br>
<br>
EmuTOS checks for partitions sizes against the whole disk size, and refuse to use
the disk if partitions have boundaries outside the disk. The last partition created
with Cecile on a hard disk has a wrong size (1 sector off limits), and if you
have only 1 partition created, its size is wrong, and EmuTOS won't use it. So create at least
2 partitions if you want to boot EmuTOS.
</p>

<a name="harddisk_atari_hddriver"><h4>5.2.3 - HD Driver 8.13</h4></a>

<p>You run hddriver.prg first, so that hddrutil.prg can access your hard disk.
Go to 'Hardisk' -> 'Partition...', select the IDE device and partition it. Don't
forget to install the driver on it to boot from it under TOS.<br>
<br>
Booting from EmuTOS also works with it.
</p>

<a name="harddisk_atari_cbhd"><h4>5.2.4 - CBHD 5.02</h4></a>

<p>Run 'cbhd.prg' for the utility to reach the IDE disk. Then run 'cbhdconf.app'.
When you try to partition, there are some errors coming from ARAnyM, and partitioning
fails:</p>

<pre>
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x88
SET FEATURES with unknown subcommand: 0x8a
SET FEATURES with unknown subcommand: 0x8a
SET FEATURES with unknown subcommand: 0x8a
hard drive: RESET
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
write cmd 0xC4 (READ MULTIPLE) not supported
</pre>

<a name="harddisk_atari_scsitools"><h4>5.2.5 - SCSI Tools 6.52</h4></a>

<p>Run 'hushi.prg' to start the driver. Then run 'scsitool.prg' to partition the hard disk image.
Select 'Partitionen' -> 'Neu einrichten...' to create a new partition root sector for this image.
Select 'Standard' in the dialog box, then you got a new dialog box where you choose partition
types and sizes. Then select 'Ok' and 'Ja, partionieren...' to validate your changes.<br>
<br>
Now you have to install the driver. In 'Treiber' menu, select 'Instalieren...'. Select the new
partition where to install the hard disk driver. Once installed, reconfigure it so it does not
search for SCSI or ACSI drives ('Gerätereihenfolge' in installation dialog box). Just keep
I0 and I1 for IDE devices.<br>
<br>
Surprinsingly, no error messages from the IDE emulation layer. And the image boots with both
TOS and EmuTOS without problems.
</p>

<a name="harddisk_atari_icd"><h4>5.2.6 - ADSCSI</h4></a>

<p>Like other drivers, you need to run it first. The program is 'icdboot.prg'.
All other programs, like 'hdutil.prg' (for configuration) requires it to be run.
Unfortunately, it seems there is a problem with IDE emulation not suiting the
driver:
</p>

<pre>
IO write(f00000h): current command is 20h
IO read(f00000h) with drq == 0: last command was 20h
</pre>

<a name="harddisk_linux"><h3>5.3 - Partition the hard disk image under Linux</h3></a>

<p>Linux come with several partition utilities: mpartition (from mtools), cfdisk, fdisk, sfdisk,
parted and many more. All these tools will create a PC-like root sector on the hard disk image,
so not all Atari hard disk drivers can be installed on these.<br>
<br>
ID you can use for partitions are 04 (FAT16<32MB), 06 (FAT16), 83 (Linux) for the most useful for
an Atari system.<br>
<br>
EmuTOS supports the PC root sector format without an hard disk driver.
</p>

<a name="harddisk_linux_fdisk"><h4>5.3.1 - Using fdisk</h4></a>

<p>You need to give it the C/H/S parameters of the disk image, as written in ARAnyM config file.
In our case:</p>

<pre>
$ /sbin/fdisk -C 8 -H 16 -S 63 /path/to/harddisk.img
</pre>

<p>Press 'm' for some help. You need to create a partition (and choose its ID), then write the
created partition table to the image before quitting.</p>

<a name="harddisk_linux_sfdisk"><h4>5.3.2 - Using sfdisk</h4></a>

<p>You need to give it the C/H/S parameters of the disk image, as written in ARAnyM config file.
In our case:</p>

<pre>
$ /sbin/sfdisk -C 8 -H 16 -S 63 /path/to/harddisk.img
Warning: test.img is not a block device
Disk test.img: cannot get geometry

Disk test.img: 8 cylinders, 16 heads, 63 sectors/track

sfdisk: ERROR: sector 0 does not have an msdos signature
 test.img: unrecognized partition table type
Old situation:
No partitions found
Input in the following format; absent fields get a default value.
&lt;start&gt; &lt;size&gt; &lt;type [E,S,L,X,hex]&gt; &lt;bootable [-,*]&gt; &lt;c,h,s&gt; &lt;c,h,s&gt;
Usually you only need to specify &lt;start&gt; and &lt;size&gt; (and perhaps &lt;type&gt;).

test.img1 :
</pre>

<p>Now the program asks for each partition its infos. The partitions are named 'test.img[n]'. To
create a single partition covering all the image, which ID is 4 (FAT16<32MB), just enter:</p>

<pre>
,,4
</pre>

<p>The program will use default for start and size, which is all the disk, and set the partition ID
to 4. Then it will ask the same for the other primary partitions, just reply with enter.</p>

<pre>
test.img1          0+      7       8-      4031+   4  FAT16 <32M
test.img2 :
test.img2          0       -       0          0    0  Empty
test.img3 :
test.img3          0       -       0          0    0  Empty
test.img4 :
test.img4          0       -       0          0    0  Empty
New situation:
Units = cylinders of 516096 bytes, blocks of 1024 bytes, counting from 0

   Device Boot Start     End   #cyls    #blocks   Id  System
test.img1          0+      7       8-      4031+   4  FAT16 <32M
test.img2          0       -       0          0    0  Empty
test.img3          0       -       0          0    0  Empty
test.img4          0       -       0          0    0  Empty
Warning: no primary partition is marked bootable (active)
This does not matter for LILO, but the DOS MBR will not boot this disk.
Do you want to write this to disk? [ynq]
</pre>

<p>Just reply 'y' to write your changes.</p>

<pre>
Successfully wrote the new partition table

Re-reading the partition table ...
BLKRRPART: Ioctl() inappropré pour un périphérique
</pre>

<a name="drivers"><h2>6 - ARAnyM specific drivers</h2></a>

<p>Now that you have a big hard disk image you can use and boot from, it is time
to install ARAnyM specific drivers to improve your user experience with top
experimental un-seen features. The reality is that these drivers help ARAnyM by
using direct host features without passing it to the hardware emulation layer.<br>
<br>
All ARAnyM drivers are present in the atari subdir in ARAnyM archive. They come in
various forms: TOS residents, Metados drivers, MiNT drivers, LDG libraries, and so
on.<br>
<br>
MetaDOS drivers (.BOS and .DOS) requires installation of MetaDOS <a href="#link9">[9]</a> <a href="#link10">[10]</a>,
BetaDOS <a href="#link8">[8]</a> <a href="#link9">[9]</a> <a href="#link10">[10]</a>,
Spin <a href="#link9">[9]</a> <a href="#link10">[10]</a> or ExtenDOS <a href="#link11">[11]</a> in AUTO folder on
boot drive. MiNT drivers (.XFS and .XDD) requires installation of MiNT kernel.<br>
<br>
Only the MiNT filesystem driver 'hostfs.xfs' ,the MiNT network driver 'aranym.xif',
and the MiNT osmesa driver 'nfosmesa.xdd' requires MiNT to be installed and used.
The OSmesa library 'osmesa.ldg' requires LDG <a href="#link13">[13]</a> installation.
All the other drivers must be run from the AUTO folder, before the MiNT kernel if
present.
</p>

<a name="drivers_fvdi"><h3>6.1 - FVDI</h3></a>

<p>FVDI <a href="#link12">[12]</a> is a replacement VDI like the well-known NVDI. It allows usage of custom
video and printer (among others) drivers to be used on your Atari system. 'fvdi.prg'
is a TOS resident program that must be run from the AUTO folder. It has a config
file 'fvdi.sys' at the root of the boot drive. In the config file, you'll find
the line 'PATH=' which points to a directory ('c:\gemsys' as default) where to
find its drivers (and fonts).<br>
<br>
ARAnyM needs its 'aranym.sys' driver to be put there. Near the end of the 'fvdi.sys'
file, you'll find a line like this, which tells FVDI to map VDI device 01 (default
video device) to aranym.sys driver:</p>

<pre>
01r aranym.sys mode 1024x768x16@70 assumenf
</pre>

<a name="drivers_fvdi_resolution"><h4>6.1.1 - Setting FVDI's video resolution</h4></a>

<p>Near the end of 'fvdi.sys' configuration file, you'll see you can pass the
resolution as a parameter to the driver:</p>

<pre>
01r aranym.sys mode 1024x768x16@70 assumenf
</pre>

<p>The resolution is fixed here and can not be changed after FVDI is started. You
can also force a resolution in ARAnyM's [AUTOZOOM] section of its config file,
for example for a 640x480 screen, and FVDI will use it instead:</p>

<pre>
[AUTOZOOM]
FixedSize = Yes
Width = 640
Height = 480
</pre>

<p>Now ARAnyM does not need to emulate the Falcon's VIDEL video chip anymore, and
so it is much faster at displaying GEM graphics, because it is also the host's CPU
that does all the drawing, instead of the emulated m68k CPU. Beware that non-GEM
applications will not work correctly in this mode.</p>

<a name="drivers_fvdi_hostmouse"><h4>6.1.2 - Using host mouse cursor</h4></a>

<p>If you think the mouse cursor is a bit slow and jerky, it is because everything
is managed from Atari side. You have first mouse movement that goes through the
emulated IKBD 6301 processor, then the emulated m68k VDI driver must delete current
mouse cursor drawed on Atari screen, take the new mouse position into account, then
redraw the mouse cursor at a new position. Wheew.<br>
<br>
In ARAnyM, you can configure the VDI driver to use directly the host mouse cursor,
so all the steps mentionned above will be short-circuited. Just fill the [NFVDI]
section of ARAnym's configuration file this way:</p>

<pre>
[NFVDI]
UseHostMouseCursor = Yes
</pre>

<p>Restart ARAnyM, and check the super fast mouse cursor. There is still a problem
remaining: At start, the Atari OS thinks the mouse position is at position
x1,y1 on the Atari screen, whereas in reality, you see it at position x2,y2. So
when you click, nothing may happen, or you'll see yourself not clicking where it
should be. You need to 'calibrate' the host mouse cursor, so the Atari OS and
the host both have the same mouse position. To calibrate the mouse cursor, just
move it to all sides of the Atari screen, and it should be OK.</p>

<a name="drivers_fvdi_renderer"><h4>6.1.3 - Selecting VDI renderer</h4></a>

<p>If your host system has hardware accelerated OpenGL, and your ARAnyM is compiled
with OpenGL support, then you can try the OpenGL VDI backend instead of the pure
software backend.You select it in the [NATFEATS] section of ARAnyM config file:</p>

<pre>
[NATFEATS]
Vdi = opengl
</pre>

<p>Default value is 'Vdi = soft' for the software backend. You must also enable
global OpenGL usage for ARAnyM in the [OPENGL] section:</p>

<pre>
[OPENGL]
Enabled = Yes
</pre>

<p>As usual, you need to restart ARAnyM for changes to taken into account.<br>
Note: currently you can't use the ARAnyM GUI when OpenGL is enabled, because
GUI routines are still software-rendering only.</p>

<a name="drivers_hostfs"><h3>6.2 - Filesystem driver</h3></a>

<p>This disk driver allows you to access host filesystem directly without passing
through the hard disk emulation layer. There are drivers for both Metados 'hostfs.dos'
and MiNT 'hostfs.xfs'.</p>

<a name="drivers_hostfs_dos"><h4>6.2.1 - MetaDOS driver</h4></a>

<p>First as said before, you need to install MetaDOS, Spin, BetaDOS or ExtenDOS to
load the driver at boot time. All have a configuration file 'config.sys' or
'bdconfig.sys' depending on the loader. Note: after some tests, it appears the
driver does not work with MetaDOS (and Spin which uses MetaDOS), so use either
BetaDOS or ExtenDOS.<br>
<br>
You need to edit this file to add a line like this:</p>

<pre>
*DOS, \auto\hostfs.dos, P:P
</pre>

<p>As you see, you have complete pathname to the driver, and 'P:P' means that it
maps the GEMDOS drive letter P to the MetaDOS device P. In fact the MetaDOS device
does not exists. But you must use the same letter for GEMDOS drive and MetaDOS
device. Standard GEM fileselector only have drive letters from A to P, so this is
why it would be wise to not assign GEMDOS drives letters Q to Z.<br>
<br>
The GEMDOS drive is configured in ARAnyM's config file, [HOSTFS] section, where
you map a drive to a host filesystem directory:</p>

<pre>
[HOSTFS]
P = /path/to/my/favorite/atari/software/
</pre>

<p>Now you don't need floppies anymore to move, copy and access files from your
virtual Atari machine.</p>

<a name="drivers_hostfs_xfs"><h4>6.2.2 - MiNT driver</h4></a>

<p>If you installed the MiNT multitasking kernel, then there is a driver for it.
Just copy the 'hostfs.xfs' file in the MiNT directory, and all drives declared
in [HOSTFS] section will be mounted under the U:\ directory.</p>

<a name="drivers_network"><h3>6.3 - Network driver</h3></a>

<p>'aranym.xif' is the MiNT driver for ARAnyM networking. It emulates an Ethernet card
on Atari side.</p>

<a name="drivers_nfcdrom"><h3>6.4 - CD-ROM driver</h3></a>

<p>This driver 'nfcdrom.bos' allows usage of CD-ROM (and playing audio CD) from your
Atari applications. To access the files on a CD-ROM, you'll need an ISO9660 filesystem
driver, that you should already have with the program you use to load the driver.<br>
<br>
In the MetaDOS (or other) configuration file, you just have to add a line like this:</p>

<pre>
*BOS, \auto\nfcdrom, Y
</pre>

<p>This will create a MetaDOS device Y, which is declared in the ARAnyM config file
in the section [CDROMS]:</p>

<pre>
[CDROMS]
Y = 0
</pre>

<p>The number is the nth CD-ROM device on your host system, starting from 0. Now
you can play audio CD with any Atari application. If you want data CD-ROM access,
you'll need to use Linux nfcdrom driver on ARAnyM side, and install an ISO9660
filesystem driver in MetaDOS configuration file for the MetaDOS device.<br>
<br>
Currently in ARAnyM, there are 2 nfcdrom drivers: the SDL one (works everywhere)
but only allows audio CD control, and the Linux one which gives you total control
over the CD-ROM drive. You choose which one to select in the [NATFEATS] section of
ARAnyM config file:</p>

<pre>
[NATFEATS]
CDROM = linux
</pre>

<p>The default value for CDROM is 'sdl' of course. The ISO9660 filesystem can then
be mapped to the MetaDOS device in its config.sys file:</p>

<pre>
*DOS, \auto\iso9660.dos, H:Y
</pre>

<p>This line will create a GEMDOS drive H to access the CD-ROM filesystem through
MetaDOS device Y.</p>

<a name="drivers_nfjpeg"><h3>6.5 - JPEG image decoder</h3></a>

<p>If you know Brainstorm's JPEG DSP decoder for Falcon, you know it is much faster
to decode JPEG images than poor Falcon 030/16 MHz cpu. With this driver, it is
the host cpu that will decode the image for your Atari applications. Just install
'nfjpeg.prg' in the AUTO folder to run it at your system's boot. This program
is TOS resident, so it must be run before MiNT kernel.</p>

<a name="drivers_nfosmesa"><h3>6.6 - OSMesa software OpenGL driver</h3></a>

<p>This one is a little tricky, there are both a device driver 'nfosmesa.xdd' required
for MiNT, and a library 'osmesa.ldg' for Atari applications. LDG <a href="#link13">[13]</a> must be installed
for the library to be loaded/usable by applications. OSMesa is an OpenGL offscreen
renderer, i.e. it renders images using host CPU in RAM. The result is then passed
to the Atari application for final display.<br>
<br>
For OSMesa to operate properly, you must have OSMesa host's libraries compiled and
installed. Then, fill the [NFOSMESA] section of the ARAnyM configuration file:</p>

<pre>
[NFOSMESA]
ChannelSize = 0
LibGL = /path/to/libGL.so
LibOSMesa = /path/to/libOSMesa.so
</pre>

<p>Channel size is the number of bits per color channel. Default is 8 (0 in config
file), it means that one colour component (R,G,B,A) will use 8 bits. Other values
are 16 and 32. It means a single pixel could use 8 or 16 bytes to be stored.<br>
<br>
If you have ARAnyM compiled with OpenGL support, and this implementation is not
coming from Mesa <a href="#link14">[14]</a>, then the libraries will conflict.
For example if you have installed drivers from your video card's vendor, then you
can't use both with ARAnyM (i.e. libGL for your card and libGL from Mesa).<br>
<br>
However, if you have ARAnyM compiled with OpenGL support, you can use OSMesa if you
use the 16 or 32 bits per channel version (libOSMesa16 or libOSMesa32), because
they embed Mesa's libGL implementation, so no conflict in this case.<br>
<br>
Let me do a list of what can/can not be used:</p>

<table border="1">
<tr>
<td><strong>ARAnyM compiled<br>with OpenGL</strong>
<td><strong>ARAnyM compiled<br>with NFOSMesa</strong>
<td><strong>NFOSMesa availability<br>for Atari applications</strong>
<tr>
<td>No
<td>No
<td>None
<tr>
<td>Yes
<td>No
<td>None
<tr>
<td>No
<td>Yes
<td>All libOSMesa implementations
<tr>
<td>Yes
<td>Yes
<td>Only with libOSMesa16 and libOSMesa32
</table>

<p>If you use libOSMesa16 or libOSMesa32, you must put the corresponding value in
'ChannelSize' (i.e. 16 or 32), and 'LibGL=' will not be used. If you use default
libOSMesa, set 'ChannelSize' to 0, and 'libGL=' will be used. In all cases, you
must set correctly 'libOSMesa='.</p>

<a name="drivers_nfpci"><h3>6.7 - PCI driver</h3></a>

<p>Latest Atari compatible hardware like Medusa, Hades or Milan have PCI bus to
improve the system extensions. However, specific drivers are required for each
PCI card. Currently the nfpci driver only allows you to list host PCI devices
(a good start!). Just install 'nfpci.prg' in the AUTO folder to run it at your
system's boot. This program is TOS resident, so it must be run before MiNT kernel.
</p>

<a name="drivers_audio"><h3>6.8 - Audio driver</h3></a>

<p>With the Falcon, Atari added specific Xbios system calls to drive the sound
hardware. So now it is possible for different hardware to be used by Atari
applications, provided they use the system calls. Under MiNT, an audio device
driver should be used when it will be done/debugged/stable.<br>
<br>
ARAnyM has some DMA audio emulation, but it may not be sufficient for programs to
operate properly. Well-written applications use Xbios, and could use the ARAnyM
audio driver.<br>
<br>
Run 'zmagxsnd.prg' to install this compatibility layer, and you should have a better
audio experience under ARAnyM (only with compatible applications of course). This
program is TOS resident, so it must be run before MiNT kernel.</p>

<a name="links"><h2>7 - Links</h2></a>
<ul>
<li><a name="link1">[1] </a><a href="http://www.seimet.de/atari_english.html">Uwe Seimet's web site: Bootconf, HD Driver</a>
<li><a name="link2">[2] </a><a href="http://emutos.sourceforge.net">EmuTOS</a>
<li><a name="link3">[3] </a><a href="http://ftp.fr.debian.org/debian/dists/stable/main/installer-m68k/current/images">Debian m68k installer</a>
<li><a name="link4">[4] </a><a href="http://ftp.lip6.fr/pub/atari/Disk/">LIP6 Atari FTP archive, Disk</a>
<li><a name="link5">[5] </a><a href="ftp://chapelie.rma.ac.be/atari/utilities/disktools/">Chapelie Atari FTP archive, utilities/disktools</a>
<li><a name="link6">[6] </a><a href="http://centek.online.fr/atari/softs/s_cecile.htm">Centek's website</a>
<li><a name="link7">[7] </a><a href="http://atari.apinc.org/atari/download/disks.htm">musique.atari.org website</a>
<li><a name="link8">[8] </a><a href="http://www.ettnet.se/~dlanor/main/html/ra_files.htm">Ulf Ronald Andersson's website</a>
<li><a name="link9">[9] </a><a href="ftp://chapelie.rma.ac.be/atari/utilities/cd-rom/">Chapelie Atari FTP archive, utilities/cd-rom</a>
<li><a name="link10">[10] </a><a href="http://ftp.lip6.fr/pub/atari/CD-rom/Drivers/">LIP6 Atari FTP archive, CD-rom/Drivers</a>
<li><a name="link11">[11] </a><a href="http://www.anodynesoftware.com/">Anodyne software's website</a>
<li><a name="link12">[12] </a><a href="http://www.klockars.net/fvdi.html">FVDI's website</a>
<li><a name="link13">[13] </a><a href="http://ldg.sourceforge.net">LDG's website</a>
<li><a name="link14">[14] </a><a href="http://www.mesa3d.org">Mesa's website</a>
</ul>

<hr>
Copyright (c) 2005 Patrice Mandin, ARAnyM dev team

</body></html>
